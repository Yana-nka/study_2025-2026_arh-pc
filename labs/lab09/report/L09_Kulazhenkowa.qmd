---
## Author
author:
  name: Кулаженкова Яна Сергеевна
  email: 1032253497@rudn.ru
  affiliation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
      postal-code: 117198
      city: Москва
      address: ул. Миклухо-Маклая, д. 6

## Title
title: "Отчёт по лабораторной работе №9"
subtitle: "Понятие подпрограммы. Отладчик GDB"
license: "CC BY"
---

# Цель работы

Приобретение навыков написания программ с использованием подпрограмм. Знакомство с методами отладки при помощи GDB и его основными возможностями.

# Задание

Освоить принципы организации подпрограмм в ассемблере, изучить инструменты отладки с использованием GDB, включая установку точек останова, пошаговую отладку и обработку аргументов командной строки.

# Теоретическое введение

Отладка – это систематический процесс поиска и исправления ошибок в программном коде, включающий этапы обнаружения, локализации, диагностики и устранения дефекта. Для её проведения используются методы контрольных точек и специализированные программы-отладчики, такие как GDB (GNU Debugger). GDB предоставляет ключевые возможности для низкоуровневого анализа: управление выполнением программы (запуск, остановка), установку точек останова командой `break`, пошаговое прохождение кода (`stepi`) и исследование состояния программы через регистры (`info registers`) и память (`x`).

Важной особенностью GDB при работе с машинным кодом является функция дизассемблирования, позволяющая отображать выполняемые инструкции в синтаксисе ATT или Intel. Это необходимо для детального понимания логики работы программы на уровне процессора. Анализ особенно важен при использовании подпрограмм, механизм вызова (`call`) и возврата (`ret`) которых напрямую влияет на состояние стека и потока управления.

Таким образом, владение инструментарием GDB, включая установку точек останова, пошаговое выполнение и анализ данных, является основополагающим навыком для диагностики и устранения ошибок в программном обеспечении, в том числе, написанном на ассемблере.

# Выполнение лабораторной работы
## Реализация подпрограмм в NASM

Перед началом выполнения лабораторной работы создадим каталог для файлов ([рис. @fig-001]).

![Переход в каталог лабораторной работы №9](image/1.png){#fig-001 width=90%}

В качестве примера рассмотрим программу вычисления арифметического выражения с помощью подпрограммы _calcul. Для этого в файл lab09-1.asm введем текст программы из листинга 9.1 ([рис. @fig-002]).

![Содержимое файла lab09-1](image/2.png){#fig-002 width=90%}

Создадим  исполняемый файл и проверим его работу ([рис. @fig-003]).

![Продемонстрируем работу файла lab09-1](image/3.png){#fig-003 width=90%}

Рассмотрим еще один пример. Измените текст программы ([рис. @fig-004]).

![Изменим код](image/4.png){#fig-004 width=90%}

Продемонстрируем работу кода программы ([рис. @fig-005]).

![Работа измененного кода](image/5.png){#fig-005 width=90%}

## Отладка программам с помощью GDB

Далее создадим файл lab09-2.asm с текстом программы для печати сообщения Hello world ([рис. @fig-006]).

![Программа для печати сообщения Hello world!](image/6.png){#fig-006 width=90%}

Получим исполняемый файл и загрузим его в отладчик gdb ([рис. @fig-007]).

![Загрузка исполняемого файла в отладчик](image/7.png){#fig-007 width=90%}

Теперь установим брейкпоинт на метку _start ([рис. @fig-008]).

![Установка breakpoint](image/8.png){#fig-008 width=90%}

Посмотрим дизассемблированный код программы с помощью команды disassemble ([рис. @fig-009]).

![Дизассемблированный код](image/9.png){#fig-009 width=90%}

Посмотрим также на отображение команд с Intel’овским синтаксисом, введя команду set ([рис. @fig-010]).

![Отображение команды с Intel синтаксисом](image/10.png){#fig-010 width=90%}

Включим режим псевдографики для более удобного анализа программы ([рис. @fig-011]).

![Решим псевдографики](image/12.png){#fig-011 width=90%}

## Добавление точек останова

Для установки точки останова воспользуемся командой break ([рис. @fig-012]).

![Установка точек останова](image/14.png){#fig-012 width=90%}

## Работа с данными программы в GDB
Отладчик может показывать содержимое ячеек памяти и регистров, а при необходимости позволяет вручную изменять значения регистров и переменных. Изучим способы применения команды stepi и info registers. Посмотрим значение переменных msg1 по имени и msg2 по адресу ([рис. @fig-013]).

![Значение переменных msg1 и msg2](image/16.png){#fig-013 width=90%}

Теперь изучим команду set. Изменим первый символ переменной msg1 ([рис. @fig-014]).

![Использование команды set](image/17.png){#fig-014 width=90%}

Также заменим любой символ во второй переменной msg2 ([рис. @fig-015]).

![Использование команды set](image/18.png){#fig-015 width=90%}

Чтобы посмотреть значения регистров используем команду print /F <val> ([рис. @fig-016]).

![Просмотр значения регистров](image/19.png){#fig-016 width=90%}

## Обработка аргументов командной строки в GDB

Подготовим файлы для работы. Скопируем файл lab8-2.asm и создадим исполняемый файл ([рис. @fig-017]).

![Подготовка файла для работы](image/20.png){#fig-017 width=90%}

Исследуем расположение аргументов командной строки в стеке после запуска программы с помощью gdb. Для этого установим точку останова перед первой инструкцией в программе и запустим ее ([рис. @fig-018]).

![Установка точки останова](image/21.png){#fig-018 width=90%}

Продемонстрируем остальные позиции стека ([рис. @fig-019]).

![Позиции стека](image/22.png){#fig-019 width=90%}

# Задание для самостоятельной работы

## Задание 1

Реализуем вычисление значения функции как подпрограмму ([рис. @fig-020]).

![Задание 1](image/23.png){#fig-020 width=90%}

## Задание 2

С помощью отладчика GDB определим ошибку и исправим ее ([рис. @fig-021]) и ([рис. @fig-022]).

![Задание 2](image/24.png){#fig-021 width=90%}

![Задание 2](image/25.png){#fig-022 width=90%}

# Выводы

В результате выполнения лабораторной работы были достигнуты следующие ключевые цели:
1. Освоены основы построения подпрограмм в языке ассемблера NASM и механизма их вызова посредством инструкций `call` и `ret`.
2. Получены практические навыки использования отладчика GDB для эффективного поиска и устранения ошибок в программах.
3. Ознакомились с процедурой дизассемблирования программы и работой с разными форматами отображения машинного кода.

Таким образом, закреплены знания о принципах организации и отладки программ на низком уровне, что обеспечит успешное дальнейшее развитие практических навыков программирования и понимания архитектуры вычислительных систем.
